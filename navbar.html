<!DOCTYPE html>
<html lang="en">

<head>
  <!-- <script src="jquery.cookies.js"></script>
  <script type="text/javascript"
    src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script> -->
</head>
<!-- <body> -->
<nav class="navbar1 navbar-expand-lg " style="background-color: black;">
  <div class="container-fluid">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo01"
      aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation"
      style="float:left;margin-right: 10px;">
      <span class="navbar-toggler-icon"><i class="fal fa-bars" style="color: white;margin-top: 10px;"></i></span>
    </button>
    <div style="width: auto;float:left" class="navbar-toggler">
      <span class="nav-item dropdown ">
        <a class="nav-link dropdown-toggle plantDropdown1" href="#" id="navbarDropdown" role="button"
          data-bs-toggle="dropdown" aria-expanded="false" style="color:aliceblue;padding:.5rem 0rem">
          <i class="fal fa-cube" style="color:aliceblue"></i></a>
        <ul class="dropdown-menu dropdown-menu-dark ab" aria-labelledby="navbarDropdown"
          style="background-color: #192039;">
        </ul>
      </span>
      <span class="nav-item dropdown ">
        <a class="nav-link dropdown-toggle divisionDropdown1" href="#" id="navbarDropdown" role="button"
          data-bs-toggle="dropdown" aria-expanded="false" style="color:aliceblue;padding:.5rem 0rem">
          <i class="fal fa-cube" style="color:aliceblue"></i></a>
        <ul class="dropdown-menu dropdown-menu-dark divisionDropdown" id="divisionDropdown"
          aria-labelledby="navbarDropdown" style="background-color: #192039;">
        </ul>
      </span>
      <span class="nav-item dropdown ">
        <a class="nav-link dropdown-toggle lineDropdown1" href="#" id="navbarDropdown" role="button"
          data-bs-toggle="dropdown" aria-expanded="false" style="padding-top:0px;color:aliceblue;padding:.5rem 0rem">
          <i class="fal fa-cube" style="color:aliceblue"></i></a>
        <ul class="dropdown-menu dropdown-menu-dark lineDropdown" aria-labelledby="navbarDropdown" id="lineDropdown"
          style="background-color: #192039;">
        </ul>
      </span>
      <span class="nav-item dropdown ">
        <a class="nav-link dropdown-toggle locationDropdown1" href="#" id="navbarDropdown" role="button"
          data-bs-toggle="dropdown" aria-expanded="false" style="color:aliceblue;padding:.5rem 0rem">
          <i class=" fal fa-map-marker-alt" style="color:aliceblue"></i></a>
        <ul class=" dropdown-menu dropdown-menu-dark locationDropdown" aria-labelledby="navbarDropdown"
          id="locationDropdown" style="background-color: #192039;">
        </ul>
      </span>
    </div>
    <!-- <i class="fal fa-cube" style="color:aliceblue"></i>
    <i class="fal fa-cube" style="color:aliceblue"></i>
    <i class=" fal fa-map-marker-alt" style="color:aliceblue"></i> -->
    <span style="color: white"></span>
    <div class="dropdown navbar-toggler">
      <a class="nav-link dropdown-toggle" href="#" id="logout" role="button" data-bs-toggle="dropdown"
        aria-expanded="false" style="padding-top:0px;color:aliceblue">
        <span style="float: left;text-align: right;width:auto;margin-top:0px;line-height:20px;padding-right: 8px;"><span
            id="user" class="user"></span>
          <br />
          <small>Available</small>
        </span>
        <span style="width:30%">
          <img src="avatar-s-11.jpg" style="width: 40px;border-radius: 20px;height: 40px;" class="userImg"
            id="userImg"></img>
        </span>
      </a>
      <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="locationDropdownn" id="logout"
        style="background-color: #192039;">
        <li data-menu="" class="active" onclick="logout()"><a class="dropdown-item" data-toggle="dropdown"
            style="font-size: 14px;">Logout</a>
        </li>
      </ul>
    </div>
    <div class="collapse navbar-collapse" id="navbarTogglerDemo012">
      <div class="col-md-4">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item dropdown ">
            <a class="nav-link dropdown-toggle plantDropdown1 " href="#" id="navbarDropdown" role="button"
              data-bs-toggle="dropdown" aria-expanded="false" style="padding-top:0px;color:aliceblue">
              <i class="fal fa-cube" style="margin-top:13px;color:aliceblue"></i>
              <span id="selectedPlant" data-i18n="UI Elements" style="font-size: 14px;">Select Plant</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-dark ab" aria-labelledby="navbarDropdown"
              style="background-color: #192039">
            </ul>
          </li>
          <li class="nav-item dropdown ">
            <a class="nav-link dropdown-toggle divisionDropdown1" href="#" id="navbarDropdown" role="button"
              data-bs-toggle="dropdown" aria-expanded="false" style="padding-top:0px;color:aliceblue">
              <i class="fal fa-cube" style="margin-top:13px;color:aliceblue"></i>
              <span id="selectedDivision" data-i18n="UI Elements" style="font-size: 14px;">Select Division</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-dark divisionDropdown" id="divisionDropdown"
              aria-labelledby="navbarDropdown" style="background-color: #192039">
            </ul>
          </li>
          <!-- <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle divisionDropdown1" href="#" id="navbarDropdown" role="button"
              data-bs-toggle="dropdown" aria-expanded="false" style="padding-top:0px;color:aliceblue">
              <i class="fas fa-language" style="font-size: large;"></i></span>
            </a>
            <ul class="dropdown-menu dropdown-menu-dark divisionDropdown3" id="divisionDropdown3"
              aria-labelledby="navbarDropdown" style="background-color: #192039">
              <li data-menu="" class="active" rel="en"><a onclick="translatePage(this)"
                  class="dropdown-item notranslate" data-toggle="dropdown" data-i18n="English">English</a></li>
              <li data-menu="" rel="hi"><a onclick="translatePage(this)" class="dropdown-item notranslate"
                  data-toggle="dropdown" data-i18n="Hindi">Hindi</a></li>
              <li data-menu="" rel="pa"><a onclick="translatePage(this)" class="dropdown-item notranslate"
                  data-toggle="dropdown" data-i18n="Punjabi">Punjabi</a></li>
            </ul>
          </li> -->

          <!-- <li class="nav-item dropdown">
            <a class="dropdown-toggle nav-link" href="#" data-toggle="dropdown"><i class="fas fa-language"
                style="font-size: large;"></i>
            </a>
            <ul id="selectLanguage" class="dropdown-menu">
              <li data-menu="" class="active" rel="en"><a onclick="translatePage(this)"
                  class="dropdown-item notranslate" data-toggle="dropdown" data-i18n="English">English</a></li>
              <li data-menu="" rel="hi"><a onclick="translatePage(this)" class="dropdown-item notranslate"
                  data-toggle="dropdown" data-i18n="Hindi">Hindi</a></li>
              <li data-menu="" rel="pa"><a onclick="translatePage(this)" class="dropdown-item notranslate"
                  data-toggle="dropdown" data-i18n="Punjabi">Punjabi</a></li>
            </ul>

          </li> -->

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle lineDropdown1" href="#" id="navbarDropdown" role="button"
              data-bs-toggle="dropdown" aria-expanded="false" style="padding-top:0px;color:aliceblue">
              <i class="fal fa-cube" style="margin-top:13px;color:aliceblue"></i>
              <span id="selectedLine" data-i18n="UI Elements" style="font-size: 14px;">Select Line</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-dark lineDropdown" aria-labelledby="navbarDropdown" id="lineDropdown"
              style="background-color: #192039;">
            </ul>
          </li>
        </ul>
      </div>
      <div class="col-md-4" style="text-align: center;">
        <img src="auto_log.png" style="width: 30%;"></img>
      </div>
      <div class="col-md-4 nav navbar-nav navbar-right">
        <!-- <div style="width: 40%;float: left;"></div> -->
        <div style="float: left;width: 100%;">
          <div style="float: left;width: 50%;text-align: right;">
            <div class="dropdown " style="float: right;">
              <a class="nav-link dropdown-toggle locationDropdown1" href="#" id="navbarDropdown" role="button"
                data-bs-toggle="dropdown" aria-expanded="false" style="padding-top:0px;color:aliceblue">
                <i class=" fal fa-map-marker-alt" style="margin-top:13px;color:aliceblue"></i>
                <span id="selectedLocation" data-i18n="UI Elements" style="font-size: 14px;">Select location</span>
              </a>
              <ul class=" dropdown-menu dropdown-menu-dark locationDropdown" aria-labelledby="navbarDropdown"
                id="locationDropdown" style="background-color: #192039;">
              </ul>
            </div>
          </div>
          <div style="float: left;width: 50%;text-align: right;color:aliceblue">
            <div class="dropdown">
              <a class="nav-link dropdown-toggle " href="#" id="logout" role="button" data-bs-toggle="dropdown"
                aria-expanded="false" style="padding-top:0px;color:aliceblue;font-size: 14px;">
                <span style="float: left;text-align: right;margin-top:0px;line-height:20px;padding-right: 8px;"><span
                    id="user" class="user"></span>
                  <br />
                  <small>Available</small>
                </span>
                <span style="width:30%">
                  <img src="avatar-s-11.jpg" style="width: 40px;border-radius: 20px;height: 40px;" class="userImg"
                    id="userImg"></img>
                </span>
              </a>
              <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="locationDropdownn" id="logout"
                style="background-color: #192039;">
                <li data-menu="" class="active" onclick="logout()"><a class="dropdown-item" data-toggle="dropdown"
                    style="font-size: 14px;">Logout</a>
                </li>
              </ul>
            </div>
          </div>

        </div>

      </div>

    </div>
  </div>
</nav>
<!-- </body> -->
<script src="analogClock.js"></script>

<script>
  var TimouT = null;
  var muT = null;
  var timerData = {};
  var divisionData = [];
  var linesData = [];
  var locationData = [];
  var plantId = "";
  var divId = "";
  var shiftsObject = {};
  var lineId = "";
  var plants = [];
  var downtimeD = {};
  var lineD = {};
  var currentShift = "";
  // 
  var mID = "";
  // var currentShift = "";
  var currentDate = "";
  var currentTime = {};
  var operatorData = [];
  var operators = [];
  var selOperatorId = "none";
  var dtOptions = {};
  var selectedDowntime = "";
  var optionTypeValue = "";
  var initialPulseId = "";
  var subOptionD = {};
  var downtimeOptionId = "";
  var subOptionObject = {};
  var startTime = "";
  var ghp = null;
  var subOptionTypeValue = "";
  var press = false;
  var timeArrayShow = [];


  function googleTranslateElementInit() {
    new google.translate.TranslateElement({
      pageLanguage: 'en',
      transliterationEnabled: true
    }, 'google_translate_element');
  }

  $(document).ready(async function () {
    // await googleTranslateElementInit();
    setTimeout("preventBack()", 0);
    window.onunload = function () { null };



    $('.ab').empty();
    $('.locationDropdown').empty();
    $('.user').text(localStorage.getItem("fullname"));
    var userImg = localStorage.getItem("userImg");


    var btn = document.getElementById('flip_content');
    var btn1 = document.getElementById('flip_content1');
    var btn2 = document.getElementById('flip_content2');
    var content = document.getElementById('f1_card');

    btn1.onclick = function () {
      content.classList.toggle('flip');
    }
    btn.onclick = function () {
      content.classList.toggle('flip');
    }
    btn2.onclick = function () {
      content.classList.toggle('flip');
    }


    if (localStorage.getItem("Pages") == null) {
      localStorage.setItem("Pages", "1");
    }

    if (userImg != undefined) {
      userImg = userImg.replace("uploads/", "image/")
      userImg = pelUrl + userImg
      document.getElementsByClassName("userImg").src = userImg
    }
    var plantUrl = getPlants + '?clientId=' + clientId
    plants = await getCallAPI(plantUrl, token, 'GET');
    divisionData = [];
    linesData = [];
    locationData = [];
    divisionData = await getCallAPI(pelUrl + 'client/location/plant/divisions?clientId=' + clientId, token, 'GET');
    linesData = await getCallAPI(pelUrl + 'client/location/plant/division/lines?clientId=' + clientId, token, 'GET');
    locationData = await getCallAPI(getLocations + '?clientId=' + clientId, token, 'GET');
    for (let z = 0; z < locationData.length; z++) {
      $('.locationDropdown').append(`<li data-menu="" class="active" style="font-size: 14px;"rel='${locationData[z].id}'><a onclick="populateplants(this)" class="dropdown-item" data-toggle="dropdown" data-i18n="Email">${locationData[z].name}</a></li>`);
      if (z == locationData.length - 1) {
        await populateplants(`<li data-menu="" class="active" style="font-size: 14px;" rel='${locationData[0].id}'><a onclick="populateplants(this)" class="dropdown-item" data-toggle="dropdown" data-i18n="Email">${locationData[0].name}</a></li>`)
      }
    }
    // await googleTranslateElementInit();
    // console.log("locationData", locationData);

  });
  function preventBack() {
    window.history.forward();

  }
  const populateplants = async ths => {
    $('#selectedLocation').html($(ths).text());
    var plantsD = plants.filter(obj => obj.locationId == $(ths).closest('li').attr('rel'))
    // console.log('plants', plants);
    $('.ab').empty();
    downtimeD = {};

    for (let x = 0; x < plantsD.length; x++) {
      $('.ab').append(`<li data-menu="" class="active" style="font-size: 14px;" rel='${plantsD[x].id}'><a onclick="populateDivision(this)" class="dropdown-item" data-toggle="dropdown" data-i18n="Email">${plantsD[x].name}</a></li>`);
      downtimeD[plantsD[x].id] = {};
      downtimeD[plantsD[x].id] = { "downtimeDeductions": plantsD[x].downtimeDeductions }
      if (x == plantsD.length - 1) {
        plantId = plantsD[0].id;
        localStorage.setItem("downtimeD", JSON.stringify(downtimeD));
        await populateDivision(`<li data-menu="" class="active" rel='${plantsD[0].id}'><a onclick="populateDivision(this)" class="dropdown-item" data-toggle="dropdown" data-i18n="Email">${plantsD[0].name}</a></li>`);
      }

    }
  }
  const populateDivision = async ths => {
    $('#selectedPlant').html($(ths).text());
    $(ths).closest('ul').find('li').removeClass('active')
    $(ths).closest('li').addClass('active')
    // console.log('$(ths).text()', $(ths).text(), $(ths).closest('li').attr('rel'));
    plantId = $(ths).closest('li').attr('rel');
    localStorage.setItem('opPlantId', plantId);
    var divisions = divisionData.filter(obj => obj.plantId == $(ths).closest('li').attr('rel'));
    $('.divisionDropdown').empty();
    $('.divisionDropdown').append(`<li data-menu="" class="active" style="font-size: 14px;" rel='all'><a onclick="populateLines(this)" class="dropdown-item" data-toggle="dropdown" data-i18n="Email">All</a></li>`);
    for (let j = 0; j < divisions.length; j++) {
      $('.divisionDropdown').append(`<li data-menu="" class="active" style="font-size: 14px;"rel='${divisions[j].id}'><a onclick="populateLines(this)" class="dropdown-item" data-toggle="dropdown" data-i18n="Email">${divisions[j].name}</a></li>`);
      if (j == divisions.length - 1) {
        await populateLines(`<li data-menu="" class="active" rel='${divisions[0].id}'><a onclick="populateLines(this)" class="dropdown-item" data-toggle="dropdown" data-i18n="Email">${divisions[0].name}</a></li>`);

      }
    }
  }

  // function googleTranslateElementInit() {
  //   new google.translate.TranslateElement({
  //     pageLanguage: 'en',
  //     transliterationEnabled: true
  //   }, 'google_translate_element');
  // }
  function googleTranslateElementInit1() {
    new google.translate.TranslateElement({
      pageLanguage: 'en',
      transliterationEnabled: true
    }, 'google_translate_element');
  }

  const populateLines = async ths => {
    $('#selectedDivision').html($(ths).text());
    divId = $(ths).closest('li').attr('rel');
    localStorage.setItem('opDivisionId', plantId);
    $(ths).closest('ul').find('li').removeClass('active')
    $(ths).closest('li').addClass('active')
    // console.log('$(ths).text()1', $(ths).text(), $(ths).closest('li').attr('rel'));
    var lines = [];
    lineD = {};
    if ($(ths).text() == 'All') {
      lines = linesData.filter(obj => obj.plantId == plantId);
    } else {
      lines = linesData.filter(obj => obj.divisionId == $(ths).closest('li').attr('rel'));
    }
    $('.lineDropdown').empty();
    $('.lineDropdown').append(`<li data-menu="" class="active" style="font-size: 14px;" rel='all'><a onclick="populateMachine(this)" class="dropdown-item" data-toggle="dropdown" data-i18n="Email">All</a></li>`);
    for (let j = 0; j < lines.length; j++) {
      $('.lineDropdown').append(`<li data-menu="" class="active" style="font-size: 14px;" rel='${lines[j].id}'><a onclick="populateMachine(this)" class="dropdown-item" data-toggle="dropdown" data-i18n="Email">${lines[j].name}</a></li>`);
      lineD[lines[j].id] = {};
      lineD[lines[j].id] = { 'name': lines[j]['name'] }
      if (j == lines.length - 1) {
        localStorage.setItem('LineD', JSON.stringify(lineD));

        await populateMachine(`<li data-menu="" class="active" rel='${lines[0].id}'><a onclick="populateMachine(this)" class="dropdown-item" data-toggle="dropdown" data-i18n="Email">${lines[0].name}</a></li>`);

      }
    }
  }
  const populateMachine = async ths => {
    $('#selectedLine').html($(ths).text());
    lineId = $(ths).closest('li').attr('rel');
    $(ths).closest('ul').find('li').removeClass('active');
    $(ths).closest('li').addClass('active');
    var dateData = await ist();
    var currentDate = dateData.date;
    var mUrl = getMachines + '?plantId=' + plantId;
    var statsUrl = downtimeStats + '?clientId=' + clientId + '&plantId=' + plantId;
    var shiftUrl = getIntervalsNew + '?clientId=' + clientId + '&plantId=' + plantId + '&type=Daily' + '&date=' + dateData.date;
    var shiftUrl1 = getIntervalsNew + '?clientId=' + clientId + '&plantId=' + plantId + '&type=Daily';
    if (divId != 'all') {
      mUrl += '&divisionId=' + divId;
      statsUrl += '&divisionId=' + divId;
      shiftUrl += '&divisionId=' + divId;
      shiftUrl1 += '&divisionId=' + divId;
    }
    if (lineId != 'all') {
      mUrl += '&lineId=' + lineId;
      statsUrl += '&lineId=' + lineId;
    }
    var opUrl = getOperators + '?clientId=' + clientId + '&plantId=' + plantId;
    // console.log('opUrl', opUrl);

    var opData = await getCallAPI(opUrl, token, 'GET');

    localStorage.setItem("opData", JSON.stringify(opData));
    var mData = await getCallAPI(mUrl, token, 'GET');
    console.log("Sw", mData);

    var shiftsData = await getCallAPI(shiftUrl, token, 'GET');
    if (dateData.time >= "00:00:00" && dateData.time < shiftsData[0]['startDateTime'].substring(11, 19)) {
      currentDate = moment(currentDate).add(1, "days").format("YYYY-MM-DD");
    }
    localStorage.setItem("currentDate", currentDate);
    var intervalsUrl = shiftUrl1 + "&date=" + currentDate;
    var intervalsData = await getCallAPI(intervalsUrl, token, 'GET');
    shiftsObject = {};
    for (let c = 0; c < intervalsData.length; c++) {
      shiftsObject[intervalsData[c]['name'] + '-startDateTime'] = intervalsData[c]['startDateTime'].substring(11, 19);
      shiftsObject[intervalsData[c]['name'] + '-startDate'] = intervalsData[c]['startDateTime'].substring(0, 10);
      shiftsObject[intervalsData[c]['name'] + '-endDateTime'] = intervalsData[c]['endDateTime'].substring(11, 19);
      shiftsObject[intervalsData[c]['name'] + '-endDate'] = intervalsData[c]['endDateTime'].substring(0, 10);
      if (dateData.date + 'T' + dateData.time + '.000Z' >= intervalsData[c]['startDateTime'] && intervalsData[c]['endDateTime'] > dateData.date + 'T' + dateData.time + '.000Z') {
        currentShift = intervalsData[c]['name']
        localStorage.setItem("shiftsObject", JSON.stringify(shiftsObject));
        localStorage.setItem("CurrentShift", currentShift);

      }
    }
    statsUrl += "&date=" + currentDate;
    localStorage.setItem("statsUrl", statsUrl);
    var statsData = await getCallAPI(statsUrl, token, 'GET');
    $('#data').empty();
    var mCOunt = 0;
    await mData.map((data, i) => {
      if (data && data.type && data.type == "swr" || data.type == "mwr" || data.type == "twr") {
        mCOunt++;
        $('#data').append(`<div class="col-md-3" style="float: left;" id='${data.id}'>
        <a class="opI" onClick="nextPage('${data.id}')">
        <div class="blackbox" style="min-height:259px;height:100%;background-color: #42454A;float: left;border-radius: 10px;margin: 15px;">
          <div style="padding:20px 7px 20px 15px">
            <p style="color: white;width: 100%;float: left;">
              <span style="float: left;width: 100%;font-weight:500;font-size: 19px;">
                <span style="float: left;width: 70%;font-weight:600;font-size: 19px;" >${data.name}</span>
                  <span style="float: left;text-align:right;width:30%;font-weight: 500;font-size: 20px;color: #0ed00e;" id="mu-${data.id}">0 %<span>
                    </span>
            </p>
            <div style="margin-top: 20px;">
              <p style="color: white;float: left;width: 100%;"><span
                  style="padding-right: 20px; width: auto;float: left;">STATION 1</span>
                <span style="padding-right: 10px;float: left;">: <i class="fal fa-clock"
                    style="padding-right: 10px;padding-left: 10px;"></i><span id="ct-1-${data.id}">0</span>
                  </span><span style="float: left;padding-left: 10px;"><i class="fas fa-cube"
                    style="padding-right: 10px;"></i>
                  <span id="st-1-${data.id}">0</span></span>
              </p>
              <p style="color: white;float: left;width: 100%;"><span
                  style="padding-right: 20px; width: auto;float: left;">STATION 2</span>
                <span style="padding-right: 10px;float: left;">: <i class="fal fa-clock"
                    style="padding-right: 10px;padding-left: 10px;"></i><span id="ct-2-${data.id}">0</span>
                  </span><span style="float: left;padding-left: 10px;"><i class="fas fa-cube"
                    style="padding-right: 10px;"></i>
                    <span id="st-2-${data.id}">0</span></span>
              </p>
              <p style="color: white;float: left;width: 100%;"><span
                  style="padding-right: 20px; width: auto;float: left;">STATION 3</span>
                <span style="padding-right: 10px;float: left;">: <i class="fal fa-clock"
                    style="padding-right: 10px;padding-left: 10px;"></i><span id="ct-3-${data.id}">0</span>
                 </span><span style="float: left;padding-left: 10px;"><i class="fas fa-cube"
                    style="padding-right: 10px;"></i>
                  <span id="st-3-${data.id}">0</span></span>
              </p>
              <p style="color: white;float: left;width: 100%;"><span
                  style="padding-right: 20px; width: auto;float: left;">STATION 4</span>
                <span style="padding-right: 10px;float: left;">: <i class="fal fa-clock"
                    style="padding-right: 10px;padding-left: 10px;"></i><span id="ct-4-${data.id}">0</span>
                  </span><span style="float: left;padding-left: 10px;"><i class="fas fa-cube"
                    style="padding-right: 10px;"></i>
                    <span id="st-4-${data.id}">0</span></span>
              </p>
            </div>
          </div>
        </div>
      </a>
      </div>`);
      }
    })
    if (mCOunt == 0) {
      $('#data').append(`<div><h4 style="color:white;text-align:center;margin:22%" >No Machines (Robot) Found. </h4></div>`)
    } else {
      console.log("statsData12", statsData);
      await machineUt(statsData);
      muT = await setInterval(async function () { console.log("SSS"); await statsDataUrl(); }, 1 * 60 * 1000);

      await socket.on(plantId, function (data) {
        // console.log("SwamiData", data, plantId)
        if ('count' in data) {
          if ('stationNo' in data && 'cycleTime' in data) {
            $(`#ct-${data['stationNo']}-${data['machineId']}`).text(data['cycleTime']);
          }
        }
        if ('stationCount' in data) {
          for (let b = 0; b < data['stationCount'].length; b++) {
            $(`#st-${data['stationCount'][b]['number']}-${data['machineId']}`).text(data['stationCount'][b]['value']);
          }
        }
      });
      // console.log('mIk', statsData, downtimeD);
      if (localStorage.getItem("Pages") == "2") {
        for (let h = 0; h < 99999; h++) {
          await clearInterval(h)
        }
        await $('#machines').hide();
        await $('#machinesProfile').show();
        await init();
        // 
        TimouT = await setInterval(async function () { await init2(); }, 1 * 60 * 1000);

      }
    }
  }

  async function statsDataUrl() {

    var dateData = await ist();
    var currentDate = dateData.date;
    // var mUrl = getMachines + '?plantId=' + plantId;
    var statsUrl = downtimeStats + '?clientId=' + clientId + '&plantId=' + plantId;
    // var shiftUrl = getIntervalsNew + '?clientId=' + clientId + '&plantId=' + plantId + '&type=Daily' + '&date=' + dateData.date;
    // var shiftUrl1 = getIntervalsNew + '?clientId=' + clientId + '&plantId=' + plantId + '&type=Daily';
    if (divId != 'all') {
      // mUrl += '&divisionId=' + divId;
      statsUrl += '&divisionId=' + divId;
      // shiftUrl += '&divisionId=' + divId;
      // shiftUrl1 += '&divisionId=' + divId;
    }
    if (lineId != 'all') {
      // mUrl += '&lineId=' + lineId;
      statsUrl += '&lineId=' + lineId;
    }
    // var opUrl = getOperators + '?clientId=' + clientId + '&plantId=' + plantId;
    // console.log('opUrl', opUrl);

    // var opData = await getCallAPI(opUrl, token, 'GET');

    // localStorage.setItem("opData", JSON.stringify(opData));
    // var mData = await getCallAPI(mUrl, token, 'GET');
    // console.log("Sw", mData);

    // var shiftsData = await getCallAPI(shiftUrl, token, 'GET');
    // if (dateData.time >= "00:00:00" && dateData.time < shiftsData[0]['startDateTime'].substring(11, 19)) {
    //   currentDate = moment(currentDate).add(1, "days").format("YYYY-MM-DD");
    // }
    // localStorage.setItem("currentDate", currentDate);
    // var intervalsUrl = shiftUrl1 + "&date=" + currentDate;
    // var intervalsData = await getCallAPI(intervalsUrl, token, 'GET');
    // shiftsObject = {};
    // for (let c = 0; c < intervalsData.length; c++) {
    //   shiftsObject[intervalsData[c]['name'] + '-startDateTime'] = intervalsData[c]['startDateTime'].substring(11, 19);
    //   shiftsObject[intervalsData[c]['name'] + '-startDate'] = intervalsData[c]['startDateTime'].substring(0, 10);
    //   shiftsObject[intervalsData[c]['name'] + '-endDateTime'] = intervalsData[c]['endDateTime'].substring(11, 19);
    //   shiftsObject[intervalsData[c]['name'] + '-endDate'] = intervalsData[c]['endDateTime'].substring(0, 10);
    //   if (dateData.date + 'T' + dateData.time + '.000Z' >= intervalsData[c]['startDateTime'] && intervalsData[c]['endDateTime'] > dateData.date + 'T' + dateData.time + '.000Z') {
    //     currentShift = intervalsData[c]['name']
    //     localStorage.setItem("shiftsObject", JSON.stringify(shiftsObject));
    //     localStorage.setItem("CurrentShift", currentShift);

    //   }
    // }
    statsUrl += "&date=" + currentDate;
    localStorage.setItem("statsUrl", statsUrl);
    var statsData = await getCallAPI(statsUrl, token, 'GET');
    muT = await setInterval(async function () { await machineUt(statsData) }, 1 * 60 * 1000);

  }
  async function machineUt(statsD) {
    console.log("currentShift786", currentShift);
    for (let s = 0; s < statsD.length; s++) {
      if (statsD[s].stats && Object.values(statsD[s].stats).length != 0) {
        var shiftobj = statsD[s].stats[currentShift];
        if (shiftobj != undefined) {
          // console.log("shiftobj", shiftobj);
          // console.log('shiftobj', shiftobj, currentShift);
          var cal1 = shiftobj.runtime + shiftobj.loading + shiftobj.unloading;
          var totaldeduction = 0;

          Object.keys(shiftobj.activity).map((data) => {
            if (downtimeD[plantId]["downtimeDeductions"].includes(data)) {
              totaldeduction += shiftobj.activity[data];
            } else {
              // machine_Downtimes += machine_activity[data];
            }
          });
          var cal2 = (shiftobj.total - shiftobj.breaks) - totaldeduction;
          var mu = (cal1 / cal2) * 100;
          console.log('`#mu-${statsD[s].machineId}`', `#mu-${statsD[s].machineId}`, isFinite(mu) && mu ? mu.toFixed(2) + " %" : 0 + "%")
          $(`#mu-${statsD[s].machineId}`).text(isFinite(mu) && mu ? mu.toFixed(2) + " %" : 0 + "%");
        }
      }
    }
  }

  async function nextPage(machineID) {
    localStorage.setItem("machineID", machineID);
    // window.location.href = "index.html?id=" + machineID;
    await $('#machines').hide();
    await $('#machinesProfile').show();
    for (let h = 0; h < 99999; h++) {
      await clearInterval(h)
    }
    await init();
    TimouT = await setInterval(async function () { await init2(); }, 1 * 60 * 1000);

  }
  const msToHMS = (ms) => {
    // console.log('ms', ms, `machines[${idx}]`, window.machines[idx])//, window.machines[idx].timer)
    // ms = window.machines[idx].downtimeData.startDateTime
    var ms = new Date(ms);
    var current = IST();
    var diff = current - ms;
    function pad(n, z) {
      z = z || 2;
      return ('00' + n).slice(-z);
    }
    var mis = diff % 1000;
    diff = (diff - mis) / 1000;
    var secs = diff % 60;
    diff = (diff - secs) / 60;
    var mins = diff % 60;
    var hrs = (diff - mins) / 60;
    // console.log("timer", pad(hrs) + ':' + pad(mins) + ':' + pad(secs), ms)
    // $(`#timer${idx}`).text(pad(hrs) + ':' + pad(mins) + ':' + pad(secs));
    // $(`#TimeDiv`).empty();
    // $(`#TimeDiv`).append(`<h6 style="line-height: 1rem;">Timer : <span class="Time1 time2 Time3" id="timer${mID}">00:00:00</span></h6>`);
    // await $(`.Time`).attr('id', `timer${mID}`);
    // await $(`#timer`).text("00:00:00");
    // await $(`#timer${mID}`).text("00:00:00");
    $(`#timer${mID}`).html(pad(hrs) + ':' + pad(mins) + ':' + pad(secs))
    // $(`#timer`).html(pad(hrs) + ':' + pad(mins) + ':' + pad(secs))
  }
  async function machineProfileData() { }

  async function translatePage(ths) {
    $('#selectedLanguage').html($(ths).text())
    $(ths).closest('ul').find('li').removeClass('active')
    $(ths).closest('li').addClass('active')
    let languageId = $(ths).closest('li').attr('rel')
    $.cookie('googtrans', `/en/${languageId}`);
    location.reload(true);
  }
  async function init() {
    console.log("A1Swami", " Shree Swami Samarth");
    // await googleTranslateElementInit1();

    $('.divisionDropdown1').prop('disabled', 'disabled');
    $('.lineDropdown1').prop('disabled', true);
    $('.plantDropdown1').prop('disabled', true);
    $('.locationDropdown1').prop('disabled', true);
    localStorage.setItem("Pages", "2");
    press = false;
    mID = localStorage.getItem("machineID");
    operatorData = [];
    shiftsObject = {};
    operators = [];
    selOperatorId = "none"
    dtOptions = {};
    selectedDowntime = "";
    downtimeOptionId = "";
    // for (let h = 0; h < 99999; h++) {
    //   await clearInterval(h)
    // }
    // await clearInterval(ghp);1
    if (timerData[mID] && timerData[mID].timeID) {
      await clearInterval(timerData[mID].timeID);
    }
    // await $(`#timer`)
    await $(`.TimeDiv`).empty();
    await $(`.TimeDiv`).append(`<h6 style="line-height: 1rem;">Timer : <span class="Time1" id="timer${mID}">00:00:00</span></h6>`);
    // await $(`.Time`).attr('id', `timer${mID}`);
    // await $(`#timer`).text("00:00:00");
    await $(`#timer${mID}`).text("00:00:00");
    await $("#dtWatch").hide();
    await $("#dtButtons").show();
    currentTime = await ist();
    currentShift = localStorage.getItem("CurrentShift");
    currentDate = localStorage.getItem("currentDate");
    operatorData = JSON.parse(localStorage.getItem("opData"));
    statsUrl = localStorage.getItem("statsUrl");
    shiftsObject = JSON.parse(localStorage.getItem("shiftsObject"));
    // console.log('shiftsObjectSW', shiftsObject);
    var machineUrl = getMachines + '?clientId=' + clientId + '&id=' + mID;
    var machineData = await getCallAPI(machineUrl, token, 'GET');
    operators = await getCallAPI(getOperators + '?clientId=' + clientId + '&plantId=' + localStorage.getItem("opPlantId"), token, 'GET');
    // console.log('operators', operators);
    $('#selectOperator').empty();
    $('#selectOperator').append(`<option value="none">No Operator</option>`);

    if (operators && operators.length != 0) {
      for (let g = 0; g < operators.length; g++) {
        // if (g == 0) {
        //   $('#selectOperator').append(`<option value="none">No Operator</option>`);
        // }
        $('#selectOperator').append(`<option value=${operators[g].id}>${operators[g].fullName}</option>`);
      }
    }
    if (machineData && machineData[0] && machineData[0].image) {
      var machineImg = machineData[0].image.replace("uploads/", "image/");
      machineImg = pelUrl + machineImg
      document.getElementById("machineImage").src = machineImg;
    }
    document.getElementById("machineName").textContent = machineData && machineData[0] && machineData[0].name ? _.truncate(machineData[0].name, { 'length': 12, 'omission': '...' }) : " ";
    document.getElementById("machineName").title = machineData && machineData[0] && machineData[0].name ? machineData[0].name : " ";
    $('#machineNameD').text(machineData && machineData[0] && machineData[0].name ? machineData[0].name : " ");
    var lineOb = JSON.parse(localStorage.getItem('LineD'));
    document.getElementById("lineName").textContent = machineData && machineData[0] && machineData[0].lineId && lineOb[machineData[0].lineId] ? lineOb[machineData[0].lineId]['name'] : " ";
    // getAllOperatorLogs
    await socket.on(localStorage.getItem("opPlantId"), function (data) {
      // console.log("SwamiData", data)
      if (data['machineId'] == mID) {
        if ('count' in data) {
          if ('stationNo' in data && 'cycleTime' in data) {
            $(`#ct-${data['stationNo']}`).text(data['cycleTime']);
            console.log("cycleTime", data['cycleTime'])
          }
        }
        if ('stationCount' in data) {
          for (let b = 0; b < data['stationCount'].length; b++) {
            $(`#st-${data['stationCount'][b]['number']}`).text(data['stationCount'][b]['value']);
          }
        }
        if ('status' in data) {
          if (data['status'] == 'Active' || data['status'] == 'active') {
            document.getElementById("status").style.color = "#007F00";
            // document.getElementById("status").style.color = rgb(0, 255, 76);
            $('#status').text(data['status']);
          } else {
            document.getElementById("status").style.color = "#FF0101";
            $('#status').text(data['status']);
          }
        }

      }
    });
    var operatorUrl = getAllOperatorLogs + "?shift=" + currentShift + "&activeMachines=" + mID + "&date=" + currentDate + "&clientId=" + clientId;
    var opData = await getCallAPI(operatorUrl, token, 'GET');
    console.log('KLJ', opData);

    // console.log('SwamiopName', opData, operators, operatorUrl);
    if (opData.length != 0) {
      // opData[0].operatorId;
      var opName = operatorData.filter(obj => obj.id == opData[0].operatorId);
      var desigOprId = '';
      selOperatorId = opName[0].id;
      document.getElementById('selectOperator').value = selOperatorId;
      // console.log("opName", opName);
      if (opName && opName[0] && opName[0].fullName) {
        if (opName[0].aadharNumber) {
          desigOprId = ' (XXXX-XXXX-' + ((opName[0].aadharNumber).toString()).slice(-4) + ')'
          if (opName[0].designation) desigOprId = ', ' + opName[0].designation + ' (XXXX-XXXX-' + ((opName[0].aadharNumber).toString()).slice(-4) + ')'
        } else {
          desigOprId = ''
          if (opName[0].designation) desigOprId = ', ' + opName[0].designation
        }
        $('#operatorName').text(opName[0].fullName + desigOprId);
        $("#operatorNameModal").text(opName[0].fullName + desigOprId)
        $("#operatorIdModal").text(opName[0].id);
        opName[0].type ? $("#operatorType").text(opName[0].type) : $("#operatorType").text('Operator')

      } else {
        $('#operatorName').text("");
      }
      if (opName && opName[0] && opName[0].image) {
        var opImg = opName[0].image.replace("uploads/", "image/");
        opImg = opmsUrl + opImg;
        // console.log('JK', opImg);
        document.getElementById("operatorImage").src = opImg;
      }
    }
    else {
      $('#operatorName').text("No Operator Selected");
      $(`#operatorImage`).attr('src', 'default.gif');
      selOperatorId = 'none';
      document.getElementById('selectOperator').value = "none";
      $('#select2-selectOperator-container').text('Select Operator')
      //   // $('#operatorName').text('No Operator Selected');
      $("#operatorNameModal").text('No Operator Selected')
      $('#operatorId').text('');
      $("#operatorIdModal").text('')
      $("#operatorType").text('')
      $("#joining").text('')
      $("#contact").text('')
      $("#avgPerformance").text('')
      $("#efficiency").text('')
    }
    await operatorEff();
    await hourlyData();

    // console.log("operatorUrl", operatorUrl, opData);
  }

  async function init2() {
    console.log("A1Swami", " Shree Swami Samarth !!");
    $('.divisionDropdown1').prop('disabled', 'disabled');
    $('.lineDropdown1').prop('disabled', true);
    $('.plantDropdown1').prop('disabled', true);
    $('.locationDropdown1').prop('disabled', true);
    localStorage.setItem("Pages", "2");
    press = false;
    mID = localStorage.getItem("machineID");
    operatorData = [];
    shiftsObject = {};
    operators = [];
    selOperatorId = "none"
    dtOptions = {};
    selectedDowntime = "";
    downtimeOptionId = "";
    // for (let h = 0; h < 99999; h++) {
    //   await clearInterval(h)
    // }
    // await clearInterval(ghp);1
    // if (timerData[mID] && timerData[mID].timeID) {
    //   await clearInterval(timerData[mID].timeID);
    // }
    // await $(`#timer`)
    // await $(`.TimeDiv`).empty();
    // await $(`.TimeDiv`).append(`<h6 style="line-height: 1rem;">Timer : <span class="Time1" id="timer${mID}">00:00:00</span></h6>`);

    // await $("#dtWatch").hide();
    // await $("#dtButtons").show();
    currentTime = await ist();
    currentShift = localStorage.getItem("CurrentShift");
    currentDate = localStorage.getItem("currentDate");
    operatorData = JSON.parse(localStorage.getItem("opData"));
    statsUrl = localStorage.getItem("statsUrl");
    shiftsObject = JSON.parse(localStorage.getItem("shiftsObject"));
    // console.log('shiftsObjectSW', shiftsObject);
    var machineUrl = getMachines + '?clientId=' + clientId + '&id=' + mID;
    var machineData = await getCallAPI(machineUrl, token, 'GET');
    operators = await getCallAPI(getOperators + '?clientId=' + clientId + '&plantId=' + localStorage.getItem("opPlantId"), token, 'GET');
    // console.log('operators', operators);

    if (operators && operators.length != 0) {
      $('#selectOperator').empty();
      for (let g = 0; g < operators.length; g++) {
        if (g == 0) {
          $('#selectOperator').append(`<option value="none">No Operator</option>`);
        }
        $('#selectOperator').append(`<option value=${operators[g].id}>${operators[g].fullName}</option>`);
      }
    }
    if (machineData && machineData[0] && machineData[0].image) {
      var machineImg = machineData[0].image.replace("uploads/", "image/");
      machineImg = pelUrl + machineImg
      document.getElementById("machineImage").src = machineImg;
    }
    document.getElementById("machineName").textContent = machineData && machineData[0] && machineData[0].name ? _.truncate(machineData[0].name, { 'length': 12, 'omission': '...' }) : " ";
    document.getElementById("machineName").title = machineData && machineData[0] && machineData[0].name ? machineData[0].name : " ";
    var lineOb = JSON.parse(localStorage.getItem('LineD'));
    document.getElementById("lineName").textContent = machineData && machineData[0] && machineData[0].lineId && lineOb[machineData[0].lineId] ? lineOb[machineData[0].lineId]['name'] : " ";

    var operatorUrl = getAllOperatorLogs + "?shift=" + currentShift + "&activeMachines=" + mID + "&date=" + currentDate + "&clientId=" + clientId;
    var opData = await getCallAPI(operatorUrl, token, 'GET');
    // console.log('KLJ', opData);

    // console.log('SwamiopName', opData, operators, operatorUrl);
    if (opData.length != 0) {
      // opData[0].operatorId;
      var opName = operatorData.filter(obj => obj.id == opData[0].operatorId);
      var desigOprId = '';
      selOperatorId = opName[0].id;
      document.getElementById('selectOperator').value = selOperatorId;
      // console.log("opName", opName);
      if (opName && opName[0] && opName[0].fullName) {
        if (opName[0].aadharNumber) {
          desigOprId = ' (XXXX-XXXX-' + ((opName[0].aadharNumber).toString()).slice(-4) + ')'
          if (opName[0].designation) desigOprId = ', ' + opName[0].designation + ' (XXXX-XXXX-' + ((opName[0].aadharNumber).toString()).slice(-4) + ')'
        } else {
          desigOprId = ''
          if (opName[0].designation) desigOprId = ', ' + opName[0].designation
        }
        $('#operatorName').text(opName[0].fullName + desigOprId);
        $("#operatorNameModal").text(opName[0].fullName + desigOprId)
        $("#operatorIdModal").text(opName[0].id);
        opName[0].type ? $("#operatorType").text(opName[0].type) : $("#operatorType").text('Operator')

      } else {
        $('#operatorName').text("");
      }
      if (opName && opName[0] && opName[0].image) {
        var opImg = opName[0].image.replace("uploads/", "image/");
        opImg = opmsUrl + opImg;
        // console.log('JK', opImg);
        document.getElementById("operatorImage").src = opImg;
      }
    }
    else {
      $('#operatorName').text("No Operator Selected");
      $(`#operatorImage`).attr('src', 'default.gif');
      selOperatorId = 'none';
      document.getElementById('selectOperator').value = "none";
      $('#select2-selectOperator-container').text('Select Operator')
      //   // $('#operatorName').text('No Operator Selected');
      $("#operatorNameModal").text('No Operator Selected')
      $('#operatorId').text('');
      $("#operatorIdModal").text('')
      $("#operatorType").text('')
      $("#joining").text('')
      $("#contact").text('')
      $("#avgPerformance").text('')
      $("#efficiency").text('')
    }
    await operatorEff();
    await hourlyData2();
    // console.log("operatorUrl", operatorUrl, opData);

  }
  async function showOperatorModal() {
    $("#operatorModal").modal('show')
  }


  async function hourlyData() {
    timeArrayShow = [];
    // var from, to; //to current-time 
    // from = await setTime(shiftsObject[currentShift + '-startDate'], shiftsObject[currentShift + '-startDateTime']);
    // to = await setTime(currentDate, currentTime.time);
    var from, to;
    from = await setTime(shiftsObject[currentShift + '-startDate'], shiftsObject[currentShift + '-startDateTime']);
    to = await setTime(shiftsObject[currentShift + '-endDate'], shiftsObject[currentShift + '-endDateTime']);
    var countArray = {};
    var halfHourly123 = await new Promise((r, j) => {
      dummyData(r, j, from, to, countArray)
    }).then((result) => {
      return result;
    });
    $('#countit').empty();
    $('#tbody').empty();
    $('#tbody1').empty();
    // console.log('LPL', halfHourly123);
    var halfHourlyArray = Object.keys(halfHourly123);
    var tableHead = '<tr id="timeid"><th class="rowgroup"  ></th>';
    var tableHead1 = '<tr id="timeid1"><th class="rowgroup"  ></th>';
    var Target_row_total = '<tr id="count-tt"><th style="padding: 20px;font-size: 15px;">PLAN</th>';
    var Actual_row_total = '<tr id="count-tp"><th style="padding: 20px;font-size: 15px;">ACTUAL</th></th>';
    var Vertical_table = ``;
    for (let k = 0; k < halfHourlyArray.length / 2; k++) {
      Vertical_table += `<tr>`;
      if (halfHourlyArray[k + k + 2] == undefined) {
        // console.log("hal1", halfHourlyArray[k + k].slice(0, -3));

        tableHead += `<th class="text-nowrap" style="padding: 5px;text-align:start"  onClick="showDowntimetable(${k})">${await tConvertFirst(halfHourlyArray[k + k].slice(0, -3))}</th></tr>`
        tableHead1 += `<th class="text-nowrap" style="padding: 5px;text-align:start"  onClick="showDowntimetable(${k})">${await tConvert(shiftsObject[currentShift + '-endDateTime'].slice(0, -3))}</th ></tr >`
        // tableHead += `<th class="text-nowrap">${await tConvertFirst(halfHourlyArray[k + k].slice(0, -3))}</th></tr>`

        Target_row_total += `<td style="padding: 20px;text-align: start;"><b><span id="total-target-${k}" class="total-target-${k} zero">0</span></b></td></tr>`;
        Actual_row_total += `<td style="padding: 20px;text-align: start;"><b><span id="total-actual-${k}" class="total-actual-${k} zero">0</span></b></td></tr>`;
        $('#countit').append(tableHead);
        $('#countit').append(tableHead1);
        Vertical_table += ` <td style="text-align:left;font-weight:600"  onClick="showDowntimetable(${k})">${await tConvertFirst(halfHourlyArray[k + k].slice(0, -3))} To ${await tConvert(shiftsObject[currentShift + '-endDateTime'].slice(0, -3))}</td><td style="text-align: center;"><b><span id="total-actual-${k}" class=id="total-actual-${k}">0</span></b></td><td style="text-align: center;"><b><span id="total-target-${k}" class="total-target-${k}">0</span></b></td></tr>`;
        $('#tbody').append(Target_row_total);
        $('#tbody').append(Actual_row_total);
        $('#tbody1').append(Vertical_table);
        timeArrayShow.push(halfHourlyArray[k + k].slice(0, -3) + '-' + shiftsObject[currentShift + '-endDateTime'].slice(0, -3));
      } else {
        // console.log("hal", halfHourlyArray[k + k].slice(0, -3));
        tableHead += `<th class="text-nowrap" style="padding: 5px;text-align:start"  onClick="showDowntimetable(${k})">${await tConvertFirst(halfHourlyArray[k + k].slice(0, -3))}</th>`;
        tableHead1 += `<th class="text-nowrap"style="padding: 5px;text-align:start"  onClick="showDowntimetable(${k})">${await tConvert(halfHourlyArray[k + k + 2].slice(0, -3))}</th>`;
        Target_row_total += `<td style="padding: 20px;text-align: start;"><b><span id="total-target-${k}" class="total-target-${k} zero">0</span></b></td>`;
        Actual_row_total += `<td style="padding: 20px;text-align: start;"><b><span id="total-actual-${k}" class="total-actual-${k} zero">0</span></b></td>`;
        Vertical_table += ` <td style="text-align:left;font-weight:600"  onClick="showDowntimetable(${k})">${await tConvertFirst(halfHourlyArray[k + k].slice(0, -3))} To ${await tConvert(halfHourlyArray[k + k + 2].slice(0, -3))}</td><td style="text-align: center;"><b><span id="total-actual-${k}" class="total-actual-${k}">0</span></b></td><td style="text-align: center;"><b><span id="total-target-${k}" class="total-target-${k}">0</span></b></td></tr>`;
        timeArrayShow.push(halfHourlyArray[k + k].slice(0, -3) + '-' + halfHourlyArray[k + k + 2].slice(0, -3))

      }
    }
    var hourlyUrl = halfHourlyProduction + "?clientId=" + clientId + "&plantId=" + localStorage.getItem("opPlantId") + "&machineId=" + mID + "&date=" + currentDate;
    var response = await getCallAPI(hourlyUrl, token, 'GET');

    var from, to; //to current-time 
    from = await setTime(shiftsObject[currentShift + '-startDate'], shiftsObject[currentShift + '-startDateTime']);
    to = await setTime(currentTime.date, currentTime.time);
    var countArray = {};
    var halfHourly = await new Promise((r, j) => {
      dummyData(r, j, from, to, countArray)
    }).then((result) => {
      return result;
    });
    var halfHourlyArray = Object.keys(halfHourly123);

    // console.log('hourlyResponce', response, halfHourly);
    var totalProd = 0;

    for (let s = 0; s < response.length; s++) {
      var halfHourlyArrayData = response[s].halfHourly;
      var halfHourlyTargetArrayData = response[s].halfHourlyTargets;
      var totaltargetH = 0;
      var totalactualH = 0;
      if (halfHourlyTargetArrayData != undefined && halfHourlyArrayData != undefined && Object.keys(halfHourlyTargetArrayData).length != 0 && Object.keys(halfHourlyArrayData).length != 0) {
        for (let r = 0; r < halfHourlyArray.length / 2; r++) {
          if (halfHourlyArray[r + r + 1] == undefined) {
            totalactualH += halfHourlyArrayData[halfHourlyArray[r + r]];
            var targetVal = 0;
            if (halfHourlyTargetArrayData[halfHourlyArray[r + r]].target != undefined || halfHourlyTargetArrayData[halfHourlyArray[r + r]].target != null) {
              targetVal = halfHourlyTargetArrayData[halfHourlyArray[r + r]].target;
            }
            totaltargetH += targetVal;
            totalProd += halfHourlyArrayData[halfHourlyArray[r + r]];
            $('.total-actual-' + r).text(halfHourlyArrayData[halfHourlyArray[r + r]]);
            $('.total-target-' + r).text(targetVal);
            $('#totalProduction').text(totalProd);

          } else if (halfHourlyArray[r + r + 2] == undefined) {   //full-day
            totalactualH += halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]];
            var targetVal1 = 0;
            var targetVal2 = 0;
            if (halfHourlyTargetArrayData[halfHourlyArray[r + r]].target != undefined || halfHourlyTargetArrayData[halfHourlyArray[r + r]].target != null) {
              targetVal1 = halfHourlyTargetArrayData[halfHourlyArray[r + r]].target;
            }
            if (halfHourlyTargetArrayData[halfHourlyArray[r + r + 1]].target != undefined || halfHourlyTargetArrayData[halfHourlyArray[r + r + 1]].target != null) {
              targetVal2 = halfHourlyTargetArrayData[halfHourlyArray[r + r + 1]].target;
            }
            totaltargetH += targetVal1 + targetVal2;
            totalProd += (halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]]);
            $('.total-actual-' + r).text(halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]]);
            $('.total-target-' + r).text(targetVal1 + targetVal2);
            $('#totalProduction').text(totalProd);
          }
          else {
            var targetVal1 = 0;
            var targetVal2 = 0;
            if (halfHourlyTargetArrayData[halfHourlyArray[r + r]].target != undefined || halfHourlyTargetArrayData[halfHourlyArray[r + r]].target != null) {
              targetVal1 = halfHourlyTargetArrayData[halfHourlyArray[r + r]].target;
            }
            if (halfHourlyTargetArrayData[halfHourlyArray[r + r + 1]].target != undefined || halfHourlyTargetArrayData[halfHourlyArray[r + r + 1]].target != null) {
              targetVal2 = halfHourlyTargetArrayData[halfHourlyArray[r + r + 1]].target;
            }
            totalactualH += (halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]]);
            totaltargetH += (targetVal1 + targetVal2);
            totalProd += (halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]]);
            $('.total-actual-' + r).text((halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]]));
            $('.total-target-' + r).text((targetVal1 + targetVal2));
          }
        }
      } else if (halfHourlyTargetArrayData == undefined || halfHourlyTargetArrayData == null) {
        for (let r = 0; r < halfHourlyArray.length / 2; r++) {
          if (halfHourlyArray[r + r + 1] == undefined) {
            totalactualH += halfHourlyArrayData[halfHourlyArray[r + r]];
            var targetVal = 0;
            totaltargetH += targetVal;
            totalProd += halfHourlyArrayData[halfHourlyArray[r + r]];
            $('.total-actual-' + r).text(halfHourlyArrayData[halfHourlyArray[r + r]]);
            $('.total-target-' + r).text(targetVal);
            $('#totalProduction').text(totalProd);

          } else if (halfHourlyArray[r + r + 2] == undefined) {   //full-day
            totalactualH += halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]];
            var targetVal1 = 0;
            var targetVal2 = 0;
            totaltargetH += targetVal1 + targetVal2;
            totalProd += halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]];
            $('.total-actual-' + r).text(halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]]);
            $('.total-target-' + r).text(targetVal1 + targetVal2);
            $('#totalProduction').text(totalProd);
          }
          else {
            var targetVal1 = 0;
            var targetVal2 = 0;
            totalactualH += (halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]]);
            totaltargetH += (targetVal1 + targetVal2);
            totalProd += (halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]])
            $('.total-actual-' + r).text((halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]]));
            $('.total-target-' + r).text((targetVal1 + targetVal2));
          }
        }
      }
    }
    await downtimeType();
  }
  async function hourlyData2() {
    timeArrayShow = [];
    var from, to;
    from = await setTime(shiftsObject[currentShift + '-startDate'], shiftsObject[currentShift + '-startDateTime']);
    to = await setTime(shiftsObject[currentShift + '-endDate'], shiftsObject[currentShift + '-endDateTime']);
    var countArray = {};
    var halfHourly123 = await new Promise((r, j) => {
      dummyData(r, j, from, to, countArray)
    }).then((result) => {
      return result;
    });
    $('#countit').empty();
    $('#tbody').empty();
    $('#tbody1').empty();
    var halfHourlyArray = Object.keys(halfHourly123);
    var tableHead = '<tr id="timeid"><th class="rowgroup"  ></th>';
    var tableHead1 = '<tr id="timeid1"><th class="rowgroup"  ></th>';
    var Target_row_total = '<tr id="count-tt"><th style="padding: 20px;font-size: 15px;">PLAN</th>';
    var Actual_row_total = '<tr id="count-tp"><th style="padding: 20px;font-size: 15px;">ACTUAL</th></th>';
    var Vertical_table = ``;
    for (let k = 0; k < halfHourlyArray.length / 2; k++) {
      Vertical_table += `<tr>`;
      if (halfHourlyArray[k + k + 2] == undefined) {
        tableHead += `<th class="text-nowrap" style="padding: 5px;text-align:start" onClick="showDowntimetable(${k})">${await tConvertFirst(halfHourlyArray[k + k].slice(0, -3))}</th></tr>`
        tableHead1 += `<th class="text-nowrap" style="padding: 5px;text-align:start" onClick="showDowntimetable(${k})">${await tConvert(shiftsObject[currentShift + '-endDateTime'].slice(0, -3))}</th ></tr >`
        Target_row_total += `<td style="padding: 20px;text-align: start;"><b><span id="total-target-${k}" class="total-target-${k}">0</span></b></td></tr>`;
        Actual_row_total += `<td style="padding: 20px;text-align: start;"><b><span id="total-actual-${k}" class="total-actual-${k}">0</span></b></td></tr>`;
        $('#countit').append(tableHead);
        $('#countit').append(tableHead1);
        Vertical_table += ` <td style="text-align:left;font-weight:600"  onClick="showDowntimetable(${k})">${await tConvertFirst(halfHourlyArray[k + k].slice(0, -3))} To ${await tConvert(shiftsObject[currentShift + '-endDateTime'].slice(0, -3))}</td><td style="text-align: center;"><b><span id="total-actual-${k}" class=id="total-actual-${k}">0</span></b></td><td style="text-align: center;"><b><span id="total-target-${k}" class="total-target-${k}">0</span></b></td></tr>`;
        $('#tbody').append(Target_row_total);
        $('#tbody').append(Actual_row_total);
        $('#tbody1').append(Vertical_table);
        timeArrayShow.push(halfHourlyArray[k + k].slice(0, -3) + '-' + shiftsObject[currentShift + '-endDateTime'].slice(0, -3));

      } else {
        tableHead += `<th class="text-nowrap" style="padding: 5px;text-align:start"  onClick="showDowntimetable(${k})">${await tConvertFirst(halfHourlyArray[k + k].slice(0, -3))}</th>`;
        tableHead1 += `<th class="text-nowrap"style="padding: 5px;text-align:start"  onClick="showDowntimetable(${k})" >${await tConvert(halfHourlyArray[k + k + 2].slice(0, -3))}</th>`;
        Target_row_total += `<td style="padding: 20px;text-align: start;"><b><span id="total-target-${k}" class="total-target-${k}">0</span></b></td>`;
        Actual_row_total += `<td style="padding: 20px;text-align: start;"><b><span id="total-actual-${k}" class="total-actual-${k}">0</span></b></td>`;
        Vertical_table += ` <td style="text-align:left;font-weight:600"  onClick="showDowntimetable(${k})">${await tConvertFirst(halfHourlyArray[k + k].slice(0, -3))} To ${await tConvert(halfHourlyArray[k + k + 2].slice(0, -3))}</td><td style="text-align: center;"><b><span id="total-actual-${k}" class="total-actual-${k}">0</span></b></td><td style="text-align: center;"><b><span id="total-target-${k}" class="total-target-${k}">0</span></b></td></tr>`;
        timeArrayShow.push(halfHourlyArray[k + k].slice(0, -3) + '-' + halfHourlyArray[k + k + 2].slice(0, -3));

      }
    }
    var hourlyUrl = halfHourlyProduction + "?clientId=" + clientId + "&plantId=" + localStorage.getItem("opPlantId") + "&machineId=" + mID + "&date=" + currentDate;
    var response = await getCallAPI(hourlyUrl, token, 'GET');

    var from, to; //to current-time 
    from = await setTime(shiftsObject[currentShift + '-startDate'], shiftsObject[currentShift + '-startDateTime']);
    to = await setTime(currentTime.date, currentTime.time);
    var countArray = {};
    var halfHourly = await new Promise((r, j) => {
      dummyData(r, j, from, to, countArray)
    }).then((result) => {
      return result;
    });
    var halfHourlyArray = Object.keys(halfHourly123);

    // console.log('hourlyResponce', response, halfHourly);
    var totalProd = 0;

    for (let s = 0; s < response.length; s++) {
      var halfHourlyArrayData = response[s].halfHourly;
      var halfHourlyTargetArrayData = response[s].halfHourlyTargets;
      var totaltargetH = 0;
      var totalactualH = 0;
      if (halfHourlyTargetArrayData != undefined && halfHourlyArrayData != undefined && Object.keys(halfHourlyTargetArrayData).length != 0 && Object.keys(halfHourlyArrayData).length != 0) {
        for (let r = 0; r < halfHourlyArray.length / 2; r++) {
          if (halfHourlyArray[r + r + 1] == undefined) {
            totalactualH += halfHourlyArrayData[halfHourlyArray[r + r]];
            var targetVal = 0;
            if (halfHourlyTargetArrayData[halfHourlyArray[r + r]].target != undefined || halfHourlyTargetArrayData[halfHourlyArray[r + r]].target != null) {
              targetVal = halfHourlyTargetArrayData[halfHourlyArray[r + r]].target;
            }
            totaltargetH += targetVal;
            totalProd += halfHourlyArrayData[halfHourlyArray[r + r]];
            $('.total-actual-' + r).text(halfHourlyArrayData[halfHourlyArray[r + r]]);
            $('.total-target-' + r).text(targetVal);
            $('#totalProduction').text(totalProd);

          } else if (halfHourlyArray[r + r + 2] == undefined) {   //full-day
            totalactualH += halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]];
            var targetVal1 = 0;
            var targetVal2 = 0;
            if (halfHourlyTargetArrayData[halfHourlyArray[r + r]].target != undefined || halfHourlyTargetArrayData[halfHourlyArray[r + r]].target != null) {
              targetVal1 = halfHourlyTargetArrayData[halfHourlyArray[r + r]].target;
            }
            if (halfHourlyTargetArrayData[halfHourlyArray[r + r + 1]].target != undefined || halfHourlyTargetArrayData[halfHourlyArray[r + r + 1]].target != null) {
              targetVal2 = halfHourlyTargetArrayData[halfHourlyArray[r + r + 1]].target;
            }
            totaltargetH += targetVal1 + targetVal2;
            totalProd += (halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]]);
            $('.total-actual-' + r).text(halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]]);
            $('.total-target-' + r).text(targetVal1 + targetVal2);
            $('#totalProduction').text(totalProd);
          }
          else {
            var targetVal1 = 0;
            var targetVal2 = 0;
            if (halfHourlyTargetArrayData[halfHourlyArray[r + r]].target != undefined || halfHourlyTargetArrayData[halfHourlyArray[r + r]].target != null) {
              targetVal1 = halfHourlyTargetArrayData[halfHourlyArray[r + r]].target;
            }
            if (halfHourlyTargetArrayData[halfHourlyArray[r + r + 1]].target != undefined || halfHourlyTargetArrayData[halfHourlyArray[r + r + 1]].target != null) {
              targetVal2 = halfHourlyTargetArrayData[halfHourlyArray[r + r + 1]].target;
            }
            totalactualH += (halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]]);
            totaltargetH += (targetVal1 + targetVal2);
            totalProd += (halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]]);
            $('.total-actual-' + r).text((halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]]));
            $('.total-target-' + r).text((targetVal1 + targetVal2));
          }
        }
      } else if (halfHourlyTargetArrayData == undefined || halfHourlyTargetArrayData == null) {
        for (let r = 0; r < halfHourlyArray.length / 2; r++) {
          if (halfHourlyArray[r + r + 1] == undefined) {
            totalactualH += halfHourlyArrayData[halfHourlyArray[r + r]];
            var targetVal = 0;
            totaltargetH += targetVal;
            totalProd += halfHourlyArrayData[halfHourlyArray[r + r]];
            $('.total-actual-' + r).text(halfHourlyArrayData[halfHourlyArray[r + r]]);
            $('.total-target-' + r).text(targetVal);
            $('#totalProduction').text(totalProd);

          } else if (halfHourlyArray[r + r + 2] == undefined) {   //full-day
            totalactualH += halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]];
            var targetVal1 = 0;
            var targetVal2 = 0;
            totaltargetH += targetVal1 + targetVal2;
            totalProd += halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]];
            $('.total-actual-' + r).text(halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]]);
            $('.total-target-' + r).text(targetVal1 + targetVal2);
            $('#totalProduction').text(totalProd);
          }
          else {
            var targetVal1 = 0;
            var targetVal2 = 0;
            totalactualH += (halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]]);
            totaltargetH += (targetVal1 + targetVal2);
            totalProd += (halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]])
            $('.total-actual-' + r).text((halfHourlyArrayData[halfHourlyArray[r + r]] + halfHourlyArrayData[halfHourlyArray[r + r + 1]]));
            $('.total-target-' + r).text((targetVal1 + targetVal2));
          }
        }
      }
    }
  }

  async function showDowntimetable(index) {

    var time = timeArrayShow[index].split("-");
    var startDate = null;
    var endDate = null;

    if (time[0] > "00:00" && time[0] < Object.values(shiftsObject)[0].substring(0, 5)) {
      startDate = moment(Object.values(shiftsObject)[1]).add(1, 'days').format('YYYY-MM-DD');
    } else {
      startDate = Object.values(shiftsObject)[1];
    }

    if (time[1] > "00:00" && time[1] < Object.values(shiftsObject)[0].substring(0, 5)) {
      endDate = moment(Object.values(shiftsObject)[1]).add(1, 'days').format('YYYY-MM-DD');
    } else {
      endDate = Object.values(shiftsObject)[1];

    }
    var downtimeLogsApi = getdowntime_logs + '?machineId=' + mID + '&startDateTime=' + startDate + 'T' + time[0] + ':00' + '&endDateTime=' + endDate + 'T' + time[1] + ':00';
    var downtimeRespose = await getCallAPI(downtimeLogsApi, token, 'GET');
    $('#startDate').text(startDate + " " + time[0] + ':00');
    $('#endDate').text(endDate + " " + time[1] + ':00');
    console.log("showDowntimetable", downtimeRespose);
    $('#tbodyDowntime').empty();
    if (downtimeRespose.length == 0) {
      $('#tbodyDowntime').append(`<tr><td class="text-center" colspan=5 style="color:white">No Data Found</td></tr>`);
    } else {
      for (let i = 0; i < downtimeRespose.length; i++) {
        console.log('downtimeRespose[i].startDateTime', downtimeRespose[i].startDateTime);
        $('#tbodyDowntime').append(`<tr>
    <td style="text-align: left;color:white">${downtimeRespose[i]['reason']}</td>
    <td style="text-align: left;color:white">${downtimeRespose[i]['type']}</td>
    <td style="text-align: left;color:white">${downtimeRespose[i]['startDateTime'].substring(11, 19)}</td>
    <td style="text-align: left;color:white">${downtimeRespose[i]['endDateTime'].substring(11, 19)}</td>
    <td style="text-align: left;color:white">${subDate(downtimeRespose[i].startDateTime, downtimeRespose[i].endDateTime)}</td>
  </tr>`);
      }

    }

    $("#downtimeModal").modal('show')
  }


  function subDate(start, end) {
    var d1 = moment(start);
    var d2 = moment(end);
    var response1 = d2.diff(d1);
    var d = moment.duration(response1);
    if (d.hours() !== 0) {
      return d.hours() + " Hrs " + d.minutes() + " Mins " + d.seconds() + " Sec ";
    } else {
      return d.minutes() + " Mins " + d.seconds() + " Sec ";
    }
  }
  async function setTime(d, t) {
    var dateTime = d + 'T' + t + '.000Z';
    var response = moment(dateTime).toDate();
    return response;
  }
  async function tConvert(time) {
    // Check correct time format and split into components
    time = time.toString().match(/^([01]\d|2[0-3])(:)([0-5]\d)(:[0-5]\d)?$/) || [time];

    if (time.length > 1) { // If time format correct
      time = time.slice(1);  // Remove full string match value
      // console.log('time0', time);
      time[3] = null; // Set AM/PM
      time[5] = +time[0] < 12 ? ' AM' : ' PM'; // Set AM/PM
      time[0] = +time[0] % 12 || 12; // Adjust hours
      // time[1] = null;
      // time[2] = null;
      time[1] = +time[2] == "0" ? null : ":";
      time[2] = +time[2] == "0" ? null : +time[2];
    }
    return time.join(''); // return adjusted time or original string
  }
  async function tConvertFirst(time) {
    // Check correct time format and split into components
    time = time.toString().match(/^([01]\d|2[0-3])(:)([0-5]\d)(:[0-5]\d)?$/) || [time];
    if (time.length > 1) { // If time format correct
      time = time.slice(1);  // Remove full string match value
      time[3] = null; // Set AM/PM
      time[5] = +time[0] < 12 ? ' AM' : ' PM'; // Set AM/PM
      time[0] = +time[0] % 12 || 12; // Adjust hours
      time[1] = +time[2] == "0" ? null : ":";
      time[2] = +time[2] == "0" ? null : +time[2];
    }
    return time.join(''); // return adjusted time or original string
  }
  async function downtimeType() {
    await $('#clock').empty();
    await AnalogClock("clock", new AnalogClockOption(120, "#eee", "#333"));//using option class to customize
    //base on object use, returns an clock object, can do some further style controll by the returned object.
    var opt = new AnalogClockOption(); opt.width = 100;
    await myFunctionS();

    socket.on('selectDowntime', async data => {
      if (data.machineId == mID) {
        console.log('selectDowntime', data)

        // console.log('dtType', 'Swami786786');
        console.log("KPL", "1");
        await hideButton(data.downTimeTypes[0], false);
        TimouT = await setInterval(async function () { await init2(); }, 1 * 60 * 1000);

      }
    });

    socket.on('cancelDowntime', data => {
      if (data.machineId == mID) {
        // console.log('cancelDowntime', data.machineId)
        backToDTbuttons(false);
      }
    });

    socket.on('selectDowntimeOption', data => {
      if (data.machineId == mID) {
        // console.log('SwamiMain', data)
        subDttype(data.subType.name, false);
      }
    })

    socket.on('selectDowntimeSubOption', data => {
      // console.log('selectDowntimeSubOption', data);
      if (data.machineId == mID) {
        subDtt(data.subOption.names[0], false);
      }
    });

    socket.on('initialData', async (initialData) => {
      if ("machineId" in initialData && initialData["machineId"] && mID == initialData["machineId"]) {
        console.log('initialData', initialData);
        // await clearInterval(ghp);2
        if (timerData[mID] && timerData[mID].timeID) {
          await clearInterval(timerData[mID].timeID);
        }
        // await $(`#timer`).text("00:00:00");
        await $(`#TimeDiv`).empty();
        await $(`#TimeDiv`).append(`<h6 style="line-height: 1rem;">Timer : <span class="Time1 time2 1" id="timer${mID}">00:00:00</span></h6>`);
        await $(`#timer${mID}`).text("00:00:00");
        if (!initialData.subType && !initialData.subOption) {
          startTime = initialData.startDateTime;
          // await clearInterval(ghp);
          console.log('dtType', 'Swami786786786786');
          if (timerData[mID] && timerData[mID].timeID) {
            console.log('', timerData[mID]["machineId"]);
            await clearInterval(timerData[mID].timeID);
          }
          console.log("KPL", "2");
          await hideButton(initialData.name, false);
          await startCounter(startTime);
          TimouT = await setInterval(async function () { await init2(); }, 1 * 60 * 1000);

        } else if (initialData.subType) {
          // await clearInterval(ghp);
          if (timerData[mID] && timerData[mID].timeID) {
            console.log('2', timerData[mID]["machineId"]);
            await clearInterval(timerData[mID].timeID);
          }
          startTime = initialData.subType.startDateTime;
          await subDttype(initialData.subType.name, false);
          await startCounter(startTime);
        } else if (initialData.subOption) {
          // await clearInterval(ghp);
          if (timerData[mID] && timerData[mID].timeID) {
            console.log('3', timerData[mID]["machineId"]);
            await clearInterval(timerData[mID].timeID);
          }
          startTime = initialData.subOption.startDateTime;
          await subDtt(initialData.subOption.names[0], false);
          await startCounter(startTime);

        }
      }
    });

    socket.on('activityData', async (activityData) => {
      if (activityData.machineId == mID) {
        console.log("activityData");
        $('#status').text("Loading..");
        document.getElementById("status").style.color = "#007F00";

        // if (ghp) {
        //   console.log('activityData', activityData);
        // await clearInterval(ghp)3;
        if (timerData[mID] && timerData[mID].timeID) {
          await clearInterval(timerData[mID].timeID);
        }
        // } else {
        //   console.log('activityData1', activityData);

        // }
        optionTypeValue = "";
        subOptionTypeValue = "";
        selectedDowntime = "";
        startTime = "";
        localStorage.setItem("machineStartD", "");
        // console.log('ms', localStorage.getItem("machineStartD"))
        // await $(`#timer`).text("00:00:00");
        await $(`#TimeDiv`).empty();
        await $(`#TimeDiv`).append(`<h6 style="line-height: 1rem;">Timer : <span class="Time1 time2 2" id="timer${mID}">00:00:00</span></h6>`);
        await $(`#timer${mID}`).text("00:00:00");

        await $('#subDowntime').empty();
        await $('#subDowntimeTypes').empty();
        await $("#dtWatch").hide();
        await $("#dtButtons").show();
      }
    })

    var downtimeTypesUrl = downtimeTypes + "?clientId=" + clientId + "&plantId=" + localStorage.getItem("opPlantId") + "&divisionId=" + localStorage.getItem("opDivisionId");
    var downtimeData = await getCallAPI(downtimeTypesUrl, token, 'GET');
    // console.log("downtimeData", downtimeData);
    if (downtimeData && "types" in downtimeData && downtimeData.types && downtimeData.types.length != 0) {
      for (let g = 0; g < downtimeData.types.length; g++) {
        if (g != 0) {
          dtOptions[downtimeData.types[g]['option']] = downtimeData.types[g].options;
        }
        if (g == 0) {
          var dtData = downtimeData.types[0]["options"];
          $('#downtimeButtons').empty();
          for (let d = 0; d < dtData.length; d++) {
            $('#downtimeButtons').append(`<div class="col-md-3 dtBTN"  onClick="hideButton('${dtData[d]}',${true})">
        <div class="gr" style="height: 100%;width: 90%;margin-left: 5%;border-radius: 8px;">
          <h5 style="padding: 10px;font-size:17px;">${dtData[d]}</h5>
        </div>
      </div>`);
          }
        }
      }
    }
  }
  async function backToMachine() {
    await $('.station').text("0");
    await $('.zero').text("0");
    await $('.ArmUtil').text("0 %");
    // await clearInterval(ghp);4

    $('.divisionDropdown1').prop('disabled', false);
    $('.lineDropdown1').prop('disabled', false);
    $('.plantDropdown1').prop('disabled', false);
    $('.locationDropdown1').prop('disabled', false);


    if (timerData[mID] && timerData[mID].timeID) {
      console.log("timerData[mID].timeID", timerData[mID].timeID);
      await clearInterval(timerData[mID].timeID);
    }
    // await $(`#timer`).text("00:00:00");
    console.log("NMN", `#timer${mID}`);
    await $(`#TimeDiv`).empty();
    // await $(`#TimeDiv`).append(`<h6 style="line-height: 1rem;">Timer : <span class="Time1 time2" id="timer${mID}">00:00:00</span></h6>`);
    // await $(`#timer${mID}`).text("00:00:00");

    await socket.off('selectDowntime');
    await socket.off('cancelDowntime');
    await socket.off('selectDowntimeOption');
    await socket.off('selectDowntimeSubOption');
    await socket.off('initialData');
    await socket.off('activityData');
    await localStorage.setItem("machineID", "");
    await $('#machinesProfile').hide();
    await $('#machines').show();
    await clearInterval(TimouT);
    await localStorage.setItem("Pages", "1");
    await statsDataUrl();

  }
  async function hideButton(dtType, doEmit) {
    // for (let s = 0; s < 999; s++) {
    //   await clearInterval(s);
    // }
    // await clearInterval(ghp);5

    for (let h = 0; h < 99999; h++) {
      await clearInterval(h)
    }
    if (timerData[mID] && timerData[mID].timeID) {
      console.log('LP', timerData[mID]["machineId"]);
      await clearInterval(timerData[mID].timeID);
    }
    // await $(`#timer`).text("00:00:00");
    await $(`.TimeDiv`).empty();
    await $(`.TimeDiv`).append(`<h6 style="line-height: 1rem;">Timer : <span class="Time1 time2 3 timer${mID}" id="timer${mID}">00:00:00</span></h6>`);
    await $(`.timer${mID}`).text("00:00:00");

    console.log('dtType', 'Swami786');

    $('#subDowntime').empty();
    $('#subDowntimeTypes').empty();
    $("#dtButtons").hide();
    $("#dtWatch").show();
    $('#dtReason').text(dtType);
    // $('#status').tect(dtType);
    $('#subDowntime').empty();
    $('#confirm').show()
    $('#back').show()
    $('#downtimeConfirm').hide()

    selectedDowntime = dtType;
    if (dtOptions[dtType] && dtOptions[dtType].length != 0) {
      for (let i = 0; i < dtOptions[dtType].length; i++) {
        $("#subDowntime").append(`<button id="${dtOptions[dtType][i].split(" ").join("-")}" class="btn btn-outline-info px-1 subdt all AC" style="margin:6px;float:left" onClick="subDttype('${dtOptions[dtType][i]}',${true})"
 >${dtOptions[dtType][i]}</button>`);
      }
    } else {
      $('#subDowntimeTypes').html('<div style="color:#040709">.</div>');
      $('#subDowntime').html('<div style="color:#040709">.</div>');
    }


    if (doEmit) {
      var emitData = {
        "dataId": 0,
        "downTimeTypes": [dtType],
        "machineId": mID,
        "name": dtType,
        "startDateTime": IST().toISOString(),
        "type": "activity"
      }
      socket.emit('selectDowntime', emitData)

    } else {

    }
    // console.log("KMM");

    // TimouT = await setInterval(async function () { await init2(); }, 1 * 60 * 1000);

  }
  const IST = () => {
    var dateUTC = new Date();
    var dateUTC = dateUTC.getTime();
    var dateIST = new Date(dateUTC);
    dateIST.setHours(dateIST.getHours() + 5);
    dateIST.setMinutes(dateIST.getMinutes() + 30);
    return dateIST;
  }
  async function backToDTbuttons(doEmit) {
    $("#dtWatch").hide();
    $("#dtButtons").show();

    optionTypeValue = "";
    subOptionTypeValue = "";
    selectedDowntime = "";
    startTime = "";
    subOptionObject = {};
    subOptionD = {};
    if (doEmit) {
      // console.log("doEmit", mID);
      socket.emit('cancelDowntime', { "machineId": mID })
    }
  }
  async function operatorEff() {
    console.log("KL", "OP");
    var statURL = statsUrl + '&machineId=' + mID;
    var downtimeD = JSON.parse(localStorage.getItem("downtimeD"));
    console.log('downtimeD', downtimeD);
    var statsD = await getCallAPI(statURL, token, 'GET');
    console.log('downtimeD1', statsD, statURL);

    if (statsD && statsD.length != 0) {

      var shiftobj = statsD[0].stats[currentShift];
      var totaldeduction = 0;
      var totaladd = 0;
      var LAStop = 0;
      if (shiftobj != undefined) {

        Object.keys(shiftobj.activity).map((data) => {
          if (downtimeD[localStorage.getItem("opPlantId")]["downtimeDeductions"].includes(data)) {
            totaldeduction += shiftobj.activity[data];
          } else {
            if (data != 'Late Start' && data != 'Early Stop') {
              totaladd += shiftobj.activity[data];
            } else {
              LAStop += shiftobj.activity[data];
            }
          }
        });
        var cal1 = shiftobj.runtime + shiftobj.loading + shiftobj.unloading + totaladd;
        var cal1Mu = shiftobj.runtime + shiftobj.loading + shiftobj.unloading;
        var cal2 = (shiftobj.total - shiftobj.breaks) - totaldeduction;
        console.log('cal1Mu', cal1Mu);
        var oE = (cal1 / cal2) * 100;
        var Mu = (cal1Mu / cal2) * 100;
        console.log("Mu", cal1Mu, cal2, Mu);
        $("#eff").text(isFinite(oE) && oE ? oE.toFixed(2) + " %" : 0 + "%");
        $(".ArmUtil").text(isFinite(Mu) && Mu ? Mu.toFixed(2) + " %" : 0 + "%");
        $(`#mu-${mID}`).text(isFinite(Mu) && Mu ? Mu.toFixed(2) + " %" : 0 + "%");
        $("#effTable").text(isFinite(oE) && oE ? oE.toFixed(2) + " %" : 0 + "%");
        // var idelT = shiftobj && shiftobj.idleTime ? shiftobj.idleTime.toFixed(2) : 0;
        var idle = 0;
        var onlyIdel = 0;
        if (shiftobj && shiftobj.idleTime) {
          idle = shiftobj.idleTime;
          onlyIdel = shiftobj.idleTime;
        }
        console.log("LAStop", idle, LAStop);
        idle = idle + LAStop;
        var idleTime = Math.floor(idle);
        // console.log("shiftobj1", shiftobj, shiftobj.idleTime, idleTime);
        // console.log("Swami1", Math.floor(idleTime / 60), "T" + (((Math.round(idleTime) % 60) < 10 ? '0' : ''), "K" + Math.round(idleTime) % 60))

        idleTime = Math.floor(idleTime / 60) + ':' + (((Math.round(idleTime) % 60) < 10 ? '0' : '') + Math.round(idleTime) % 60);
        onlyIdel = Math.floor(onlyIdel / 60) + ':' + (((Math.round(onlyIdel) % 60) < 10 ? '0' : '') + Math.round(onlyIdel) % 60);
        $('#idleTime').text(idleTime + " H:M");
        $('#idealTable').text(onlyIdel + " H:M");


      }

    }

  }
  async function subDttype(subDType, doEmit) {
    optionTypeValue = subDType;
    $('#subDowntimeTypes').empty();
    $(".subdt").removeClass('btn-info').addClass('btn-outline-info');
    // console.log("subDType", subDType);
    if (subDType) { $('#' + subDType.split(" ").join("-")).removeClass('btn-outline-info').addClass('btn-info'); }
    if (dtOptions[subDType] && dtOptions[subDType].length != 0) {
      for (let i = 0; i < dtOptions[subDType].length; i++) {
        $("#subDowntimeTypes").append(`<button id="sub${dtOptions[subDType][i].split(" ").join("-")}" class="btn btn-outline-info px-1 subtt all" style="margin:6px"
      onClick="subDtt('${dtOptions[subDType][i]}',${true})">${dtOptions[subDType][i]}</button>`);
      }
    }
    subOptionD = {
      "machineId": mID,
      "initialPulseId": initialPulseId,
      "subType": {
        "dataId": "",
        "name": subDType,
        "startDateTime": IST().toISOString()
      }
    }
    if (doEmit) {
      // console.log('JH', subOptionD)
      socket.emit('selectDowntimeOption', { ...subOptionD, ...{ "machineId": mID } });
    }
  }
  const submitDowntime = async (idx, initialData, callback) => {

    // console.log("SQQ", initialData);
    var ipResult = await getCallAPI(pelUrl + 'initial-pulse', token, 'POST', initialData);
    if (ipResult && ipResult.initialPulse) initialPulseId = ipResult.initialPulse._id;
    if (callback) {
      if ("initialPulseId" in subOptionD) {
        subOptionD["initialPulseId"] = initialPulseId;
        subOptionD.subType.dataId = initialPulseId;

      }
      // console.log("subOptionObject", subOptionD, initialData.startDateTime);

      subOptionD.subType.startDateTime = initialData.startDateTime
      // window.machines[idx].downtimeOption.initialPulseId = $(`#initialPulseId${idx}`).val()
      // window.machines[idx].downtimeOption.subType.dataId = $(`#initialPulseId${idx}`).val()
      callback("", subOptionD, submitDowntimeSubOption)
    } else {
      if (localStorage.getItem("machineStartD") != null || localStorage.getItem("machineStartD") != "") {
        console.log('ms1', localStorage.getItem("machineStartD"))
        await $(`#TimeDiv`).empty();
        await $(`#TimeDiv`).append(`<h6 style="line-height: 1rem;">Timer : <span class="Time1 time2 4" id="timer${mID}">00:00:00</span></h6>`);
        await $(`#timer${mID}`).text("00:00:00");
        startTime = initialData.startDateTime;
        timerData = {};
        timerData[mID] = { "timeID": setInterval(() => msToHMS(initialData.startDateTime), 1000), "machineId": mID }
        // ghp = await setInterval(() => msToHMS(initialData.startDateTime), 1000);
      }
      // completeDowntime(initialData.name, true, initialData.startDateTime, "", mID);

    }
  }
  const submitDowntimeOption = async (idx, downtimeOption, callback) => {
    console.log('downtimeOption2', downtimeOption)
    //   await reviewToken()
    $.ajax({
      url: pelUrl + 'initial-pulse',
      data: JSON.stringify(downtimeOption),
      type: "PUT",
      headers: { "Authorization": "Bearer " + token },
      dataType: 'json',
      contentType: 'application/json',
      success: async function (data) {
        downtimeOptionId = data.subTypes[data.subTypes.length - 1]._id
        // $(`#downtimeOptionId${idx}`).val(data.subTypes[data.subTypes.length - 1]._id)
        if (callback && subOptionTypeValue != "") {
          // window.machines[idx].downtimeSubOption.initialPulseId = $(`#initialPulseId${idx}`).val()
          subOptionObject.initialPulseId = initialPulseId;
          subOptionObject.subOption.optionId = downtimeOptionId;
          subOptionObject.subOption.startDateTime = downtimeOption.subType.startDateTime;
          // console.log('downtimeOption3', subOptionObject)
          submitDowntimeSubOption(idx, subOptionObject)
        } else {
          startTime = downtimeOption.subType.startDateTime;
          console.log("ms3", downtimeOption.subType.startDateTime);
          await $(`#TimeDiv`).empty();
          await $(`#TimeDiv`).append(`<h6 style="line-height: 1rem;">Timer : <span class="Time1 time2 5" id="timer${mID}">00:00:00</span></h6>`);
          await $(`#timer${mID}`).text("00:00:00");
          timerData[mID] = { "timeID": setInterval(() => msToHMS(downtimeOption.subType.startDateTime), 1000), "machineId": mID }
          // ghp = await setInterval(() => msToHMS(downtimeOption.subType.startDateTime), 1000);

        }
      },
      error: error => {
        console.log('put initial-pulse update error1', error)
        if (error && error.responseJSON && error.responseJSON.message == 'Unauthorized') logout()
        if (error && error.responseJSON) console.log(error.responseJSON)
        else if (error && error.responseText) console.log(error.responseText)
        else console.log({ error })
      }
    })
  }
  const submitDowntimeSubOption = async (idx, downtimeSubOption) => {
    // console.log('downtimeSubOption', downtimeSubOption)
    $.ajax({
      url: pelUrl + 'initial-pulse',
      data: JSON.stringify(downtimeSubOption),
      type: "PUT",
      headers: { "Authorization": "Bearer " + token },
      dataType: 'json',
      contentType: 'application/json',
      success: async function (data) {
        startTime = downtimeSubOption.subOption.startDateTime;
        console.log('ms4', downtimeSubOption.subOption.startDateTime);
        await $(`#TimeDiv`).empty();
        await $(`#TimeDiv`).append(`<h6 style="line-height: 1rem;">Timer : <span class="Time1 time2 6" id="timer${mID}">00:00:00</span></h6>`);
        $(`#timer${mID}`).text("00:00:00");
        // ghp = await setInterval(() => msToHMS(downtimeSubOption.subOption.startDateTime), 1000);
        timerData[mID] = { "timeID": setInterval(() => msToHMS(downtimeSubOption.subOption.startDateTime), 1000), "machineId": mID }

      },
      error: error => {
        console.log('put initial-pulse update error')
        if (error && error.responseJSON && error.responseJSON.message == 'Unauthorized') logout()
        if (error && error.responseJSON) console.log(error.responseJSON)
        else if (error && error.responseText) console.log(error.responseText)
        else console.log({ error })
      }
    })
  }
  async function completeDowntime() {
    event.stopPropagation()
    var currentDateTime = IST();
    var downtimeOption = "";
    if (optionTypeValue != "") {
      downtimeOption = optionTypeValue;
    }
    if (subOptionTypeValue != "") {
      downtimeOption = subOptionTypeValue;
    }

    var activityData = {
      dataId: "1",
      type: 'activity',
      name: selectedDowntime,
      option: downtimeOption,
      downTimeTypes: [selectedDowntime],
      machineId: mID,
      startDateTime: startTime,
      endDateTime: currentDateTime.toISOString()
    };
    // console.log('SwamiactivityData', activityData);
    // if (submitActivityData) {
    $.ajax({
      url: pelUrl + 'activities', //callThisApi,
      data: JSON.stringify(activityData),
      type: "POST",
      headers: { "Authorization": "Bearer " + token },
      dataType: 'json',
      contentType: 'application/json',
      success: async function (data) {
        // await clearInterval(ghp)6
        if (timerData[mID] && timerData[mID].timeID) {
          await clearInterval(timerData[mID].timeID);
        }
        localStorage.setItem("machineStartD", "");
        // console.log('ms', localStorage.getItem("machineStartD"))
        // await $(`#timer`).text("00:00:00");
        await $(`#TimeDiv`).empty();
        await $(`#TimeDiv`).append(`<h6 style="line-height: 1rem;">Timer : <span class="Time1 time2 7" id="timer${mID}">00:00:00</span></h6>`);
        await $(`#timer${mID}`).text("00:00:00");
        await $('#subDowntime').empty();
        await $('#subDowntimeTypes').empty();
        await $("#dtWatch").hide();
        await $("#dtButtons").show();
      },
      error: function (error) {
        console.log('activities error', error)
        if (error && error.responseJSON && error.responseJSON.message == 'Unauthorized') {
          window.location.href = './login.html';
        }
        if (error && error.responseJSON) console.log(error.responseJSON)
        else if (error && error.responseText) console.log(error.responseText)
        else console.log({ error })
      }
    });
  }
  async function subDtt(subDType, doEmit) {
    subOptionTypeValue = subDType;
    $(".subtt").removeClass('btn-info').addClass('btn-outline-info');
    $('#sub' + subDType.split(" ").join("-")).removeClass('btn-outline-info').addClass('btn-info');
    subOptionObject = {
      "initialPulseId": initialPulseId,
      "subOption": {
        "optionId": downtimeOptionId,
        "names": [subDType],
        "startDateTime": IST().toISOString()
      }
    }
    if (doEmit) {
      // console.log('JH', subOptionObject)
      socket.emit('selectDowntimeSubOption', { ...subOptionObject, ...{ "machineId": mID } });
    }
  }
  async function myFunctionS() {
    var machineUrl = getMachines + '?clientId=' + clientId + '&id=' + mID;
    var machineData = await getCallAPI(machineUrl, token, 'GET');
    console.log("machineData", machineData);
    var dtD = {};
    var dtOpt = {};
    var dtSubOpt = {};
    if (machineData && machineData[0] && machineData[0].downtimeData && machineData[0].downtimeData.length != 0) {
      dtD = machineData[0].downtimeData[machineData[0].downtimeData.length - 1];
    }
    if (machineData && machineData[0] && machineData[0].downtimeOptions && machineData[0].downtimeOptions.length != 0) {
      dtOpt = machineData[0].downtimeOptions[machineData[0].downtimeOptions.length - 1];
    }
    if (machineData && machineData[0] && machineData[0].downtimeSubOptions && machineData[0].downtimeSubOptions.length != 0) {
      dtSubOpt = machineData[0].downtimeSubOptions[machineData[0].downtimeSubOptions.length - 1];
    }

    var downTimeId, downTimeType, startDateTime
    if (dtD) {
      downTimeId = dtD._id
      downTimeType = dtD.name
      startDateTime = dtD.startDateTime
    } else {
      downTimeId = undefined
      downTimeType = undefined
      startDateTime = undefined
    }
    // console.log('SwamiK', dtD, dtOpt, dtSubOpt);
    if (dtD && dtD.name) {
      // console.log('dtType', 'Swami786786786');
      console.log("KPL", "3");

      await hideButton(dtD.name, false);
      TimouT = await setInterval(async function () { await init2(); }, 1 * 60 * 1000);

    }
    if (dtOpt && dtOpt.name) {
      console.log('dtType', 'Swami7867867861');
      await subDttype(dtOpt.name, false);
    }
    if (dtSubOpt && dtSubOpt.names && dtSubOpt.names[0]) {
      console.log('dtType', 'Swami7867867862');

      await subDtt(dtSubOpt.names[0], false);
    }
    if (startDateTime) {
      console.log('dtType', 'Swami7867867863');

      startTime = startDateTime;
      await startCounter(startDateTime)
    }

  }
  async function startCounter(startDateTime) {
    console.log("mID", mID);

    await $('#confirm').hide();
    await $('#back').hide();
    await $('#downtimeConfirm').show();
    // await clearInterval(ghp);7

    for (let s = 0; s < 99999; s++) {
      await clearInterval(s);
    }
    if (timerData[mID] && timerData[mID].timeID) {
      await clearInterval(timerData[mID].timeID);
    }

    // await $(`#timer`).text("00:00:00");
    //
    $('#status').text(_.truncate(selectedDowntime, { 'length': 13, 'omission': '...' }));
    document.getElementById("status").title = selectedDowntime;
    document.getElementById("status").style.color = "#FF0101";

    await $(`#TimeDiv`).empty();
    await $(`#TimeDiv`).append(`<h6 style="line-height: 1rem;">Timer : <span class="Time1 time2 8" id="timer${mID}">00:00:00</span></h6>`);
    // await $(`#timer${mID}`).text("01:00:00");
    console.log("ms2", startDateTime);
    // ghp = await setInterval(() => msToHMS(startDateTime), 1000);
    timerData[mID] = { "timeID": setInterval(() => msToHMS(startDateTime), 1000), "machineId": mID }

    await $('.all').prop('disabled', true);
  }
  async function updateOperatorTable(ths) {
    selOperatorId = "none"
    // console.log('$(ths).val()', "1" + $(ths).val());
    var operator = operators.find(o => o.id == $(ths).val())
    // console.log('ths', operator);
    if (operator) {
      if (operator.aadharNumber) {
        var desigOprId = ' (XXXX-XXXX-' + ((operator.aadharNumber).toString()).slice(-4) + ')'
        if (operator.designation) desigOprId = ', ' + operator.designation + ' (XXXX-XXXX-' + ((operator.aadharNumber).toString()).slice(-4) + ')'
      } else {
        var desigOprId = ''
        if (operator.designation) desigOprId = ', ' + operator.designation
      }
      selOperatorId = operator.id;
      $('#select2-selectOperator-container').text(operator.fullName + desigOprId)
      // $('#operatorName').text(operator.fullName + desigOprId)
      $("#operatorNameModal").text(operator.fullName + desigOprId)
      $('#operatorId').text(operator.id);
      $("#operatorIdModal").text(operator.id)
      operator.type ? $("#operatorType").text(operator.type) : $("#operatorType").text('Operator')
      // $("#joining").text(moment(operator.experience[operator.experience.length - 1]["startEmployment"]).format('DD-MM-YYYY'))
      operator.contact ? $("#contact").text(operator.contact) : $("#contact").text('')
      $("#avgPerformance").text(operator.avgPerformance)
      $("#efficiency").text(operator.efficiency)
    } else {
      $('#select2-selectOperator-container').text('Select Operator')
      // $('#operatorName').text('No Operator Selected');
      $("#operatorNameModal").text('No Operator Selected')
      $('#operatorId').text('');
      $("#operatorIdModal").text('')
      $("#operatorType").text('')
      $("#joining").text('')
      $("#contact").text('')
      $("#avgPerformance").text('')
      $("#efficiency").text('')
    }
  }
  async function acceptOperator() {
    if (selOperatorId && selOperatorId != "") {
      let now = new Date()
      now.setSeconds(0); now.setMilliseconds(0);
      let isoDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000)
      let currentDate = isoDateTime.toISOString().substr(0, 11) + '00:00:00.000Z'
      var operatorData = {
        "operatorId": selOperatorId,
        "machineId": mID,
        "clientId": clientId,
        "plantId": localStorage.getItem("opPlantId"),
        "date": currentDate,
        "dateTime": isoDateTime,
        "shift": currentShift
      }

      $.ajax({
        url: opmsUrl + 'operator-logs',
        data: JSON.stringify(operatorData),
        headers: { "Authorization": "Bearer " + token },
        type: "POST",
        dataType: 'json',
        contentType: 'application/json',
        success: (data) => {
          if (selOperatorId == 'none') {
            $(`#operatorName`).text('No Operator Selected');
            $(`#operatorImage`).attr('src', 'default.gif');
            selOperatorId = "none";
          } else {
            var operator = operators.find(o => o.id == data.operatorId)
            // console.log('operatorData1', operator, operatorData, data);
            if (operator) {
              $(`#operatorImage`).attr('src', operator.image ? opmsUrl + operator.image.replace('uploads', 'image') : apiUrl + 'image/users/default-profile-image.jpg');
              if (operator.aadharNumber) {
                var desigOprId = ' (XXXX-XXXX-' + ((operator.aadharNumber).toString()).slice(-4) + ')'
                if (operator.designation) desigOprId = ', ' + operator.designation + ' (XXXX-XXXX-' + ((operator.aadharNumber).toString()).slice(-4) + ')'
              } else {
                var desigOprId = ''
                if (operator.designation) desigOprId = ', ' + operator.designation
              }
              selOperatorId = operator.id;
              $(`#operatorName`).text(operator.fullName + desigOprId);
            } else {
              $(`#operatorName`).text('No Operator Selected');
              selOperatorId = "none";
            }
          }
          $("#operatorModal").modal('toggle');
        },
        error: (error) => {
          console.log(error)
          if (error && error.responseJSON && error.responseJSON.message == 'Unauthorized') logout()
        }
      })
    } else {
      // $("#operatorModal").modal('close');
      $("#operatorModal").modal('toggle');

    }
  }
  async function submitD(time) {
    // await clearInterval(ghp);
    $('#status').text(_.truncate(selectedDowntime, { 'length': 13, 'omission': '...' }));
    document.getElementById("status").title = selectedDowntime;
    document.getElementById("status").style.color = "#FF0101";
    if (timerData[mID] && timerData[mID].timeID) {
      await clearInterval(timerData[mID].timeID);
    }
    press = true;
    var cTime = "";
    if (time != "") {
      cTime = time;
    } else {
      cTime = IST().toISOString();
    }
    localStorage.setItem("machineStartD", cTime);
    $('.all').prop('disabled', true);
    var dataConfirm = {
      "dataId": "0",
      "downTimeTypes": [$('#dtReason').text()],
      "machineId": mID,
      "name": $('#dtReason').text(),
      "startDateTime": cTime,
      "type": "activity"
    }

    // console.log("SQ", dataConfirm);
    if (optionTypeValue != "" || subOptionTypeValue != "") {
      await submitDowntime("", dataConfirm, submitDowntimeOption);
    } else {
      await submitDowntime("", dataConfirm);
    }
    $('#confirm').hide()
    $('#back').hide()
    $('#downtimeConfirm').show()
  }
</script>
<style>
  a {
    cursor: pointer !important;
  }

  .navbar1 span.nav-item.dropdown {
    float: left;
    margin-right: 10px;
  }

  /* .goog-te-banner-frame {
    visibility: hidden !important;
  } */

  .dtBTN {
    height: auto;
    float: left;
    margin-top: 15px;
  }

  .right0 {
    right: 0 !important;
    left: 75% !important;
  }

  .TP {
    float: left;
    width: 35%;
  }

  .IT {
    float: left;
    width: 37%;
    padding-left: 50px
  }

  .OE {
    float: left;
    width: 28%;
  }

  .TH {
    margin: 0px;
  }

  .TV {
    margin: 10px 0px 0px 0px;
    display: none
  }

  .infoD {
    padding: 10px 35px;
    float: left;
    width: 100%;
    font-size: 17px;
    font-weight: 700;
  }

  nav.navbar1.navbar-expand-lg {
    float: left;
    width: 100%;
    position: fixed;
    top: 0;
    padding-top: 8px;
    padding-bottom: 8px;
  }

  .dropdown {
    position: relative;
    float: right;
  }

  .navbar-toggler {
    padding: 0 !important;
  }

  @media screen and (min-device-width: 700px) and (max-device-width: 950px) {
    #data .col-md-3 {
      flex: 0 0 auto;
      width: 50%;
    }


  }



  @media screen and (min-device-width: 350px) and (max-device-width: 1281px) {
    .TH {
      display: none;
    }

    .dtBTN {
      width: 50% !important;
    }

    .TV {
      display: inline-table;
    }

    .TP {
      width: 100%;
    }

    .IT {
      width: 100%;
      padding-left: 0px
    }

    .OE {
      width: 100%;
    }

    .infoD {
      padding: 10px 10px;
      float: left;
      width: 100%;
      font-size: 12px;
      font-weight: 600;
    }
  }

  @media screen and (min-device-width: 951px) and (max-device-width: 1050px) {
    #data .col-md-3 {
      flex: 0 0 auto;
      width: 33.3333%;
    }
  }
</style>

</html>